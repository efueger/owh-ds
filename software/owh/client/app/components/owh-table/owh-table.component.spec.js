'use strict';

describe('owhTable component: ', function() {
    var $rootScope, $injector, $templateCache, $scope;
    var $httpBackend, $compile, $http, $componentController;
    var element, scope;
    var Clusterize;


    beforeEach(function() {
        module('owh');
        Clusterize = {};
        inject(function(_$rootScope_, _$state_, _$injector_, _$templateCache_,_$location_, _$compile_, _$http_, _$componentController_ ) {
            $rootScope  = _$rootScope_;
            $injector   = _$injector_;
            $templateCache = _$templateCache_;
            $compile = _$compile_;
            $http = _$http_;
            $scope = $rootScope.$new();
            $httpBackend = $injector.get('$httpBackend');
            $componentController = _$componentController_;
            scope = $rootScope.$new();
            element = angular.element('<owh-table table-data="data" table-view="tableView"></owh-table>');
            element = $compile(element)(scope);
        });
        $templateCache.put('app/partials/marker-template.html', 'app/partials/marker-template.html');
        $templateCache.put('app/modules/home/home.html', 'app/modules/home/home.html');
        $templateCache.put('app/components/owh-table/owhTable.html', 'app/components/owh-table/owhTable.html');

        $httpBackend.whenGET('app/i18n/messages-en.json').respond({ hello: 'World' });
        $httpBackend.whenGET('app/partials/marker-template.html').respond( $templateCache.get('app/partials/marker-template.html'));
        $httpBackend.whenGET('app/components/owh-table/owhTable.html').respond( $templateCache.get('app/components/owh-table/owhTable.html'));
        $httpBackend.whenGET('/getFBAppID').respond({data: { fbAppID: 1111111111111111}});
        $httpBackend.whenGET('/yrbsQuestionsTree/2015').respond({data: {}});
    });

    //TODO: will need to load templates before this will pass, also clusterize will error without dom
    // it('should have a row of headers for each column header', function() {
    //     scope.data = {"headers":[[{"colspan":1,"rowspan":1,"title":"Race"},{"title":"Female","colspan":1,"rowspan":1,"isData":true},{"title":"Male","colspan":1,"rowspan":1,"isData":true},{"title":"Number of Deaths","colspan":1,"rowspan":1,"isData":true}]],"data":[[{"title":"American Indian","isCount":false,"rowspan":1,"colspan":1,"key":"3"},{"title":61818,"percentage":45.4427169478443,"isCount":true,"rowspan":1,"colspan":1,"pop":27554487},{"title":74217,"percentage":54.55728305215569,"isCount":true,"rowspan":1,"colspan":1,"pop":27686343},{"title":136035,"percentage":0.5862177233352274,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":55240830}],[{"title":"Asian or Pacific Islander","isCount":false,"rowspan":1,"colspan":1,"key":"4"},{"title":219028,"percentage":47.829077671917005,"isCount":true,"rowspan":1,"colspan":1,"pop":117055793},{"title":238911,"percentage":52.170922328083,"isCount":true,"rowspan":1,"colspan":1,"pop":108306177},{"title":457939,"percentage":1.9734035947102637,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":225361970}],[{"title":"Black","isCount":false,"rowspan":1,"colspan":1,"key":"2"},{"title":1344390,"percentage":49.0312749940461,"isCount":true,"rowspan":1,"colspan":1,"pop":299973609},{"title":1397513,"percentage":50.9687250059539,"isCount":true,"rowspan":1,"colspan":1,"pop":274418811},{"title":2741903,"percentage":11.815724881582167,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":574392420}],[{"title":"White","isCount":false,"rowspan":1,"colspan":1,"key":"1"},{"title":10055975,"percentage":50.609685669084,"isCount":true,"rowspan":1,"colspan":1,"pop":1710528401},{"title":9813690,"percentage":49.390314330916,"isCount":true,"rowspan":1,"colspan":1,"pop":1673513926},{"title":19869665,"percentage":85.62465380037234,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":3384042327}]],"calculatePercentage":true};
    //     scope.tableView = 'number_of_deaths';
    //     scope.$apply();
    //     var headers = element.find('th');
    //     // expect(headers.length).toEqual(4);
    // });

    it('should compileTable for death count tableView', function() {
        var bindings = {tableView: 'number_of_deaths'};
        var ctrl = $componentController('owhTable', { $scope: $scope }, bindings);

        spyOn(window, "Clusterize");
        var table = {"headers":[[{"colspan":1,"rowspan":1,"title":"Race"},{"title":"Female","colspan":1,"rowspan":1,"isData":true},{"title":"Male","colspan":1,"rowspan":1,"isData":true},{"title":"Number of Deaths","colspan":1,"rowspan":1,"isData":true}]],"data":[[{"title":"American Indian","isCount":false,"rowspan":1,"colspan":1,"key":"American Indian"},{"title":8179,"percentage":45.41870279875611,"isCount":true,"rowspan":1,"colspan":1,"pop":28544528,"ageAdjustedRate":"557.9","standardPop":32250198},{"title":9829,"percentage":54.58129720124389,"isCount":true,"rowspan":1,"colspan":1,"pop":28645741,"ageAdjustedRate":"754.4","standardPop":32369216},{"title":18008,"percentage":0.6856486667392624,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":57190269,"ageAdjustedRate":"647.7","standardPop":64619414}],[{"title":"Asian or Pacific Islander","isCount":false,"rowspan":1,"colspan":1,"key":"Asian or Pacific Islander"},{"title":29884,"percentage":48.536624979697905,"isCount":true,"rowspan":1,"colspan":1,"pop":121309960,"ageAdjustedRate":"368.3","standardPop":137270512},{"title":31686,"percentage":51.463375020302095,"isCount":true,"rowspan":1,"colspan":1,"pop":112325576,"ageAdjustedRate":"524.1","standardPop":127115817},{"title":61570,"percentage":2.3442574639680354,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":233635536,"ageAdjustedRate":"435.2","standardPop":264386329}],[{"title":"Black","isCount":false,"rowspan":1,"colspan":1,"key":"Black"},{"title":151227,"percentage":48.94711289487312,"isCount":true,"rowspan":1,"colspan":1,"pop":317237591,"ageAdjustedRate":"807.4","standardPop":359386608},{"title":157733,"percentage":51.05288710512688,"isCount":true,"rowspan":1,"colspan":1,"pop":289840863,"ageAdjustedRate":"1,193.3","standardPop":328414017},{"title":308960,"percentage":11.763550204118308,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":607078454,"ageAdjustedRate":"967.6","standardPop":687800625}],[{"title":"White","isCount":false,"rowspan":1,"colspan":1,"key":"White"},{"title":1108887,"percentage":49.55078020269183,"isCount":true,"rowspan":1,"colspan":1,"pop":1828192603,"ageAdjustedRate":"660.1","standardPop":2070887962},{"title":1128993,"percentage":50.44921979730817,"isCount":true,"rowspan":1,"colspan":1,"pop":1787480522,"ageAdjustedRate":"922.5","standardPop":2024924546},{"title":2237880,"percentage":85.2065436651744,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":3615673125,"ageAdjustedRate":"777.0","standardPop":4095812508}]],"calculatePercentage":true};
        ctrl.compileTable(table);

        expect(window.Clusterize).toHaveBeenCalled();
    });

    it('should compileTable for crude death rate tableView', function() {
        var bindings = {tableView: 'crude_death_rates'};
        var ctrl = $componentController('owhTable', { $scope: $scope }, bindings);

        spyOn(window, "Clusterize");
        var table = {"headers":[[{"colspan":1,"rowspan":1,"title":"Race"},{"title":"Female","colspan":1,"rowspan":1,"isData":true},{"title":"Male","colspan":1,"rowspan":1,"isData":true},{"title":"Number of Deaths","colspan":1,"rowspan":1,"isData":true}]],"data":[[{"title":"American Indian","isCount":false,"rowspan":1,"colspan":1,"key":"American Indian"},{"title":8179,"percentage":45.41870279875611,"isCount":true,"rowspan":1,"colspan":1,"pop":28544528,"ageAdjustedRate":"557.9","standardPop":32250198},{"title":9829,"percentage":54.58129720124389,"isCount":true,"rowspan":1,"colspan":1,"pop":28645741,"ageAdjustedRate":"754.4","standardPop":32369216},{"title":18008,"percentage":0.6856486667392624,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":57190269,"ageAdjustedRate":"647.7","standardPop":64619414}],[{"title":"Asian or Pacific Islander","isCount":false,"rowspan":1,"colspan":1,"key":"Asian or Pacific Islander"},{"title":29884,"percentage":48.536624979697905,"isCount":true,"rowspan":1,"colspan":1,"pop":121309960,"ageAdjustedRate":"368.3","standardPop":137270512},{"title":31686,"percentage":51.463375020302095,"isCount":true,"rowspan":1,"colspan":1,"pop":112325576,"ageAdjustedRate":"524.1","standardPop":127115817},{"title":61570,"percentage":2.3442574639680354,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":233635536,"ageAdjustedRate":"435.2","standardPop":264386329}],[{"title":"Black","isCount":false,"rowspan":1,"colspan":1,"key":"Black"},{"title":151227,"percentage":48.94711289487312,"isCount":true,"rowspan":1,"colspan":1,"pop":317237591,"ageAdjustedRate":"807.4","standardPop":359386608},{"title":157733,"percentage":51.05288710512688,"isCount":true,"rowspan":1,"colspan":1,"pop":289840863,"ageAdjustedRate":"1,193.3","standardPop":328414017},{"title":308960,"percentage":11.763550204118308,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":607078454,"ageAdjustedRate":"967.6","standardPop":687800625}],[{"title":"White","isCount":false,"rowspan":1,"colspan":1,"key":"White"},{"title":1108887,"percentage":49.55078020269183,"isCount":true,"rowspan":1,"colspan":1,"pop":1828192603,"ageAdjustedRate":"660.1","standardPop":2070887962},{"title":1128993,"percentage":50.44921979730817,"isCount":true,"rowspan":1,"colspan":1,"pop":1787480522,"ageAdjustedRate":"922.5","standardPop":2024924546},{"title":2237880,"percentage":85.2065436651744,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":3615673125,"ageAdjustedRate":"777.0","standardPop":4095812508}]],"calculatePercentage":true};
        ctrl.compileTable(table);

        expect(window.Clusterize).toHaveBeenCalled();
    });

    it('should compileTable with suppressed values', function() {
        var bindings = {tableView: 'crude_death_rates'};
        var ctrl = $componentController('owhTable', { $scope: $scope }, bindings);

        spyOn(window, "Clusterize");

        var table = {"headers":[[{"colspan":1,"rowspan":1,"title":"Race","$$hashKey":"object:2806"},{"colspan":1,"rowspan":1,"title":"Ethnicity","$$hashKey":"object:2807"},{"title":"Female","colspan":1,"rowspan":1,"isData":true,"$$hashKey":"object:2808"},{"title":"Male","colspan":1,"rowspan":1,"isData":true,"$$hashKey":"object:2809"},{"title":"Number of Deaths","colspan":1,"rowspan":1,"isData":true,"$$hashKey":"object:2810"}]],"data":[[{"title":"American Indian","isCount":false,"rowspan":13,"colspan":1,"key":"American Indian"},{"title":"Central and South American","isCount":false,"rowspan":1,"colspan":1,"key":"Central and South American"},{"title":0,"percentage":0,"isCount":true},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Central American","isCount":false,"rowspan":1,"colspan":1,"key":"Central American"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":15, "pop": 2500, "isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Cuban","isCount":false,"rowspan":1,"colspan":1,"key":"Cuban"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Dominican","isCount":false,"rowspan":1,"colspan":1,"key":"Dominican"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Latin American","isCount":false,"rowspan":1,"colspan":1,"key":"Latin American"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Mexican","isCount":false,"rowspan":1,"colspan":1,"key":"Mexican"},{"title":213,"percentage":41.846758349705304,"isCount":true,"rowspan":1,"colspan":1},{"title":296,"percentage":58.153241650294696,"isCount":true,"rowspan":1,"colspan":1},{"title":509,"percentage":0.01938000729510687,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Puerto Rican","isCount":false,"rowspan":1,"colspan":1,"key":"Puerto Rican"},{"title":13,"percentage":46.42857142857143,"isCount":true,"rowspan":1,"colspan":1},{"title":15,"percentage":53.57142857142857,"isCount":true,"rowspan":1,"colspan":1},{"title":28,"percentage":0.0010660907745834822,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"South American","isCount":false,"rowspan":1,"colspan":1,"key":"South American"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Spaniard","isCount":false,"rowspan":1,"colspan":1,"key":"Spaniard"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Other Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Other Hispanic"},{"title":102,"percentage":50.24630541871922,"isCount":true,"rowspan":1,"colspan":1},{"title":101,"percentage":49.75369458128079,"isCount":true,"rowspan":1,"colspan":1},{"title":203,"percentage":0.007729158115730246,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Non-Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Non-Hispanic"},{"title":7800,"percentage":45.51289532034076,"isCount":true,"rowspan":1,"colspan":1},{"title":9338,"percentage":54.48710467965924,"isCount":true,"rowspan":1,"colspan":1},{"title":17138,"percentage":0.6525237033861327,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Unknown","isCount":false,"rowspan":1,"colspan":1,"key":"Unknown"},{"title":22,"percentage":38.59649122807017,"isCount":true,"rowspan":1,"colspan":1},{"title":35,"percentage":61.40350877192983,"isCount":true,"rowspan":1,"colspan":1},{"title":57,"percentage":0.002170256219687803,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Total","isCount":false,"rowspan":1,"colspan":3,"isBold":true},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"ageAdjustedRate":"647.7","standardPop":64619414}],[{"title":"Asian or Pacific Islander","isCount":false,"rowspan":13,"colspan":1,"key":"Asian or Pacific Islander"},{"title":"Central and South American","isCount":false,"rowspan":1,"colspan":1,"key":"Central and South American"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Central American","isCount":false,"rowspan":1,"colspan":1,"key":"Central American"},{"title":17,"percentage":40.476190476190474,"isCount":true,"rowspan":1,"colspan":1},{"title":25,"percentage":59.523809523809526,"isCount":true,"rowspan":1,"colspan":1},{"title":42,"percentage":0.0015991361618752232,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Cuban","isCount":false,"rowspan":1,"colspan":1,"key":"Cuban"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Dominican","isCount":false,"rowspan":1,"colspan":1,"key":"Dominican"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Latin American","isCount":false,"rowspan":1,"colspan":1,"key":"Latin American"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Mexican","isCount":false,"rowspan":1,"colspan":1,"key":"Mexican"},{"title":70,"percentage":33.980582524271846,"isCount":true,"rowspan":1,"colspan":1},{"title":136,"percentage":66.01941747572816,"isCount":true,"rowspan":1,"colspan":1},{"title":206,"percentage":0.007843382127292763,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Puerto Rican","isCount":false,"rowspan":1,"colspan":1,"key":"Puerto Rican"},{"title":50,"percentage":35.2112676056338,"isCount":true,"rowspan":1,"colspan":1},{"title":92,"percentage":64.7887323943662,"isCount":true,"rowspan":1,"colspan":1},{"title":142,"percentage":0.005406603213959089,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"South American","isCount":false,"rowspan":1,"colspan":1,"key":"South American"},{"title":13,"percentage":37.142857142857146,"isCount":true,"rowspan":1,"colspan":1},{"title":22,"percentage":62.857142857142854,"isCount":true,"rowspan":1,"colspan":1},{"title":35,"percentage":0.0013326134682293527,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Spaniard","isCount":false,"rowspan":1,"colspan":1,"key":"Spaniard"},{"title":12,"percentage":44.44444444444444,"isCount":true,"rowspan":1,"colspan":1},{"title":15,"percentage":55.55555555555556,"isCount":true,"rowspan":1,"colspan":1},{"title":27,"percentage":0.0010280161040626436,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Other Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Other Hispanic"},{"title":216,"percentage":54.82233502538071,"isCount":true,"rowspan":1,"colspan":1},{"title":178,"percentage":45.17766497461929,"isCount":true,"rowspan":1,"colspan":1},{"title":394,"percentage":0.015001420185210428,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Non-Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Non-Hispanic"},{"title":29385,"percentage":48.63133854097709,"isCount":true,"rowspan":1,"colspan":1},{"title":31039,"percentage":51.3686614590229,"isCount":true,"rowspan":1,"colspan":1},{"title":60424,"percentage":2.3006238915511545,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Unknown","isCount":false,"rowspan":1,"colspan":1,"key":"Unknown"},{"title":111,"percentage":41.11111111111111,"isCount":true,"rowspan":1,"colspan":1},{"title":159,"percentage":58.88888888888889,"isCount":true,"rowspan":1,"colspan":1},{"title":270,"percentage":0.010280161040626434,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Total","isCount":false,"rowspan":1,"colspan":3,"isBold":true},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"ageAdjustedRate":"435.2","standardPop":264386329}],[{"title":"Black","isCount":false,"rowspan":13,"colspan":1,"key":"Black"},{"title":"Central and South American","isCount":false,"rowspan":1,"colspan":1,"key":"Central and South American"},{"title":49,"percentage":44.14414414414414,"isCount":true,"rowspan":1,"colspan":1},{"title":62,"percentage":55.85585585585585,"isCount":true,"rowspan":1,"colspan":1},{"title":111,"percentage":0.0042262884278130896,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Central American","isCount":false,"rowspan":1,"colspan":1,"key":"Central American"},{"title":256,"percentage":52.138492871690424,"isCount":true,"rowspan":1,"colspan":1},{"title":235,"percentage":47.86150712830957,"isCount":true,"rowspan":1,"colspan":1},{"title":491,"percentage":0.018694663225731777,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Cuban","isCount":false,"rowspan":1,"colspan":1,"key":"Cuban"},{"title":160,"percentage":46.647230320699705,"isCount":true,"rowspan":1,"colspan":1},{"title":183,"percentage":53.352769679300295,"isCount":true,"rowspan":1,"colspan":1},{"title":343,"percentage":0.013059611988647656,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Dominican","isCount":false,"rowspan":1,"colspan":1,"key":"Dominican"},{"title":425,"percentage":50.898203592814376,"isCount":true,"rowspan":1,"colspan":1},{"title":410,"percentage":49.101796407185624,"isCount":true,"rowspan":1,"colspan":1},{"title":835,"percentage":0.03179234988490027,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Latin American","isCount":false,"rowspan":1,"colspan":1,"key":"Latin American"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":12,"isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Mexican","isCount":false,"rowspan":1,"colspan":1,"key":"Mexican"},{"title":233,"percentage":43.30855018587361,"isCount":true,"rowspan":1,"colspan":1},{"title":305,"percentage":56.69144981412639,"isCount":true,"rowspan":1,"colspan":1},{"title":538,"percentage":0.020484172740211193,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Puerto Rican","isCount":false,"rowspan":1,"colspan":1,"key":"Puerto Rican"},{"title":222,"percentage":38.608695652173914,"isCount":true,"rowspan":1,"colspan":1},{"title":353,"percentage":61.39130434782609,"isCount":true,"rowspan":1,"colspan":1},{"title":575,"percentage":0.021892935549482222,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"South American","isCount":false,"rowspan":1,"colspan":1,"key":"South American"},{"title":42,"percentage":45.65217391304348,"isCount":true,"rowspan":1,"colspan":1},{"title":50,"percentage":54.347826086956516,"isCount":true,"rowspan":1,"colspan":1},{"title":92,"percentage":0.0035028696879171556,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Spaniard","isCount":false,"rowspan":1,"colspan":1,"key":"Spaniard"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":0,"percentage":0,"isCount":true},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Other Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Other Hispanic"},{"title":141,"percentage":44.339622641509436,"isCount":true,"rowspan":1,"colspan":1},{"title":177,"percentage":55.660377358490564,"isCount":true,"rowspan":1,"colspan":1},{"title":318,"percentage":0.012107745225626689,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Non-Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Non-Hispanic"},{"title":149008,"percentage":49.0409552270244,"isCount":true,"rowspan":1,"colspan":1},{"title":154836,"percentage":50.9590447729756,"isCount":true,"rowspan":1,"colspan":1},{"title":303844,"percentage":11.568760189733698,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Unknown","isCount":false,"rowspan":1,"colspan":1,"key":"Unknown"},{"title":682,"percentage":38.058035714285715,"isCount":true,"rowspan":1,"colspan":1},{"title":1110,"percentage":61.94196428571429,"isCount":true,"rowspan":1,"colspan":1},{"title":1792,"percentage":0.06822980957334286,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Total","isCount":false,"rowspan":1,"colspan":3,"isBold":true},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"ageAdjustedRate":"967.6","standardPop":687800625}],[{"title":"White","isCount":false,"rowspan":13,"colspan":1,"key":"White"},{"title":"Central and South American","isCount":false,"rowspan":1,"colspan":1,"key":"Central and South American"},{"title":1122,"percentage":48.21658788139235,"isCount":true,"rowspan":1,"colspan":1},{"title":1205,"percentage":51.78341211860765,"isCount":true,"rowspan":1,"colspan":1},{"title":2327,"percentage":0.08859975830199153,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Central American","isCount":false,"rowspan":1,"colspan":1,"key":"Central American"},{"title":3367,"percentage":48.85374347069066,"isCount":true,"rowspan":1,"colspan":1},{"title":3525,"percentage":51.14625652930934,"isCount":true,"rowspan":1,"colspan":1},{"title":6892,"percentage":0.26241062922961994,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Cuban","isCount":false,"rowspan":1,"colspan":1,"key":"Cuban"},{"title":7285,"percentage":48.96162376503797,"isCount":true,"rowspan":1,"colspan":1},{"title":7594,"percentage":51.03837623496202,"isCount":true,"rowspan":1,"colspan":1},{"title":14879,"percentage":0.5665130226795583,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Dominican","isCount":false,"rowspan":1,"colspan":1,"key":"Dominican"},{"title":1547,"percentage":51.42952127659575,"isCount":true,"rowspan":1,"colspan":1},{"title":1461,"percentage":48.57047872340425,"isCount":true,"rowspan":1,"colspan":1},{"title":3008,"percentage":0.11452860892668265,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Latin American","isCount":false,"rowspan":1,"colspan":1,"key":"Latin American"},{"title":346,"percentage":48.4593837535014,"isCount":true,"rowspan":1,"colspan":1},{"title":368,"percentage":51.540616246498594,"isCount":true,"rowspan":1,"colspan":1},{"title":714,"percentage":0.027185314751878794,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Mexican","isCount":false,"rowspan":1,"colspan":1,"key":"Mexican"},{"title":41395,"percentage":43.78477290516384,"isCount":true,"rowspan":1,"colspan":1},{"title":53147,"percentage":56.21522709483616,"isCount":true,"rowspan":1,"colspan":1},{"title":94542,"percentage":3.599655500381128,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Puerto Rican","isCount":false,"rowspan":1,"colspan":1,"key":"Puerto Rican"},{"title":9581,"percentage":45.7895239915886,"isCount":true,"rowspan":1,"colspan":1},{"title":11343,"percentage":54.21047600841139,"isCount":true,"rowspan":1,"colspan":1},{"title":20924,"percentage":0.796674405978028,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"South American","isCount":false,"rowspan":1,"colspan":1,"key":"South American"},{"title":2962,"percentage":50.32279986408427,"isCount":true,"rowspan":1,"colspan":1},{"title":2924,"percentage":49.67720013591573,"isCount":true,"rowspan":1,"colspan":1},{"title":5886,"percentage":0.2241075106856563,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Spaniard","isCount":false,"rowspan":1,"colspan":1,"key":"Spaniard"},{"title":276,"percentage":46.231155778894475,"isCount":true,"rowspan":1,"colspan":1},{"title":321,"percentage":53.768844221105525,"isCount":true,"rowspan":1,"colspan":1},{"title":597,"percentage":0.022730578300940673,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Other Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Other Hispanic"},{"title":6750,"percentage":46.21704895583704,"isCount":true,"rowspan":1,"colspan":1},{"title":7855,"percentage":53.782951044162964,"isCount":true,"rowspan":1,"colspan":1},{"title":14605,"percentage":0.5560805629568485,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Non-Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Non-Hispanic"},{"title":1031604,"percentage":49.909504298364396,"isCount":true,"rowspan":1,"colspan":1},{"title":1035345,"percentage":50.0904957016356,"isCount":true,"rowspan":1,"colspan":1},{"title":2066949,"percentage":78.69840215837692,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Unknown","isCount":false,"rowspan":1,"colspan":1,"key":"Unknown"},{"title":2652,"percentage":40.44532560622236,"isCount":true,"rowspan":1,"colspan":1},{"title":3905,"percentage":59.55467439377764,"isCount":true,"rowspan":1,"colspan":1},{"title":6557,"percentage":0.24965561460513902,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Total","isCount":false,"rowspan":1,"colspan":3,"isBold":true},{"title":2237880,"percentage":85.2065436651744,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"ageAdjustedRate":"777.0","standardPop":4095812508}]],"calculatePercentage":true};

        ctrl.compileTable(table);

        ctrl.tableView = 'age-adjusted_death_rates';
        ctrl.compileTable(table);

        expect(window.Clusterize).toHaveBeenCalled();
    });

    it('should compileTable when rowspanThreshold is exceeded', function() {
        var bindings = {tableView: 'number_of_deaths', rowspanThreshold: 5};
        var ctrl = $componentController('owhTable', { $scope: $scope }, bindings);

        spyOn(window, "Clusterize");

        var table = {"headers":[[{"colspan":1,"rowspan":1,"title":"Race","$$hashKey":"object:2806"},{"colspan":1,"rowspan":1,"title":"Ethnicity","$$hashKey":"object:2807"},{"title":"Female","colspan":1,"rowspan":1,"isData":true,"$$hashKey":"object:2808"},{"title":"Male","colspan":1,"rowspan":1,"isData":true,"$$hashKey":"object:2809"},{"title":"Number of Deaths","colspan":1,"rowspan":1,"isData":true,"$$hashKey":"object:2810"}]],"data":[[{"title":"American Indian","isCount":false,"rowspan":13,"colspan":1,"key":"American Indian"},{"title":"Central and South American","isCount":false,"rowspan":1,"colspan":1,"key":"Central and South American"},{"title":0,"percentage":0,"isCount":true},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Central American","isCount":false,"rowspan":1,"colspan":1,"key":"Central American"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":10,"isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Cuban","isCount":false,"rowspan":1,"colspan":1,"key":"Cuban"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Dominican","isCount":false,"rowspan":1,"colspan":1,"key":"Dominican"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Latin American","isCount":false,"rowspan":1,"colspan":1,"key":"Latin American"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Mexican","isCount":false,"rowspan":1,"colspan":1,"key":"Mexican"},{"title":213,"percentage":41.846758349705304,"isCount":true,"rowspan":1,"colspan":1},{"title":296,"percentage":58.153241650294696,"isCount":true,"rowspan":1,"colspan":1},{"title":509,"percentage":0.01938000729510687,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Puerto Rican","isCount":false,"rowspan":1,"colspan":1,"key":"Puerto Rican"},{"title":13,"percentage":46.42857142857143,"isCount":true,"rowspan":1,"colspan":1},{"title":15,"percentage":53.57142857142857,"isCount":true,"rowspan":1,"colspan":1},{"title":28,"percentage":0.0010660907745834822,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"South American","isCount":false,"rowspan":1,"colspan":1,"key":"South American"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Spaniard","isCount":false,"rowspan":1,"colspan":1,"key":"Spaniard"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Other Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Other Hispanic"},{"title":102,"percentage":50.24630541871922,"isCount":true,"rowspan":1,"colspan":1},{"title":101,"percentage":49.75369458128079,"isCount":true,"rowspan":1,"colspan":1},{"title":203,"percentage":0.007729158115730246,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Non-Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Non-Hispanic"},{"title":7800,"percentage":45.51289532034076,"isCount":true,"rowspan":1,"colspan":1},{"title":9338,"percentage":54.48710467965924,"isCount":true,"rowspan":1,"colspan":1},{"title":17138,"percentage":0.6525237033861327,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Unknown","isCount":false,"rowspan":1,"colspan":1,"key":"Unknown"},{"title":22,"percentage":38.59649122807017,"isCount":true,"rowspan":1,"colspan":1},{"title":35,"percentage":61.40350877192983,"isCount":true,"rowspan":1,"colspan":1},{"title":57,"percentage":0.002170256219687803,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Total","isCount":false,"rowspan":1,"colspan":3,"isBold":true},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"ageAdjustedRate":"647.7","standardPop":64619414}],[{"title":"Asian or Pacific Islander","isCount":false,"rowspan":13,"colspan":1,"key":"Asian or Pacific Islander"},{"title":"Central and South American","isCount":false,"rowspan":1,"colspan":1,"key":"Central and South American"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Central American","isCount":false,"rowspan":1,"colspan":1,"key":"Central American"},{"title":17,"percentage":40.476190476190474,"isCount":true,"rowspan":1,"colspan":1},{"title":25,"percentage":59.523809523809526,"isCount":true,"rowspan":1,"colspan":1},{"title":42,"percentage":0.0015991361618752232,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Cuban","isCount":false,"rowspan":1,"colspan":1,"key":"Cuban"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Dominican","isCount":false,"rowspan":1,"colspan":1,"key":"Dominican"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Latin American","isCount":false,"rowspan":1,"colspan":1,"key":"Latin American"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Mexican","isCount":false,"rowspan":1,"colspan":1,"key":"Mexican"},{"title":70,"percentage":33.980582524271846,"isCount":true,"rowspan":1,"colspan":1},{"title":136,"percentage":66.01941747572816,"isCount":true,"rowspan":1,"colspan":1},{"title":206,"percentage":0.007843382127292763,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Puerto Rican","isCount":false,"rowspan":1,"colspan":1,"key":"Puerto Rican"},{"title":50,"percentage":35.2112676056338,"isCount":true,"rowspan":1,"colspan":1},{"title":92,"percentage":64.7887323943662,"isCount":true,"rowspan":1,"colspan":1},{"title":142,"percentage":0.005406603213959089,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"South American","isCount":false,"rowspan":1,"colspan":1,"key":"South American"},{"title":13,"percentage":37.142857142857146,"isCount":true,"rowspan":1,"colspan":1},{"title":22,"percentage":62.857142857142854,"isCount":true,"rowspan":1,"colspan":1},{"title":35,"percentage":0.0013326134682293527,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Spaniard","isCount":false,"rowspan":1,"colspan":1,"key":"Spaniard"},{"title":12,"percentage":44.44444444444444,"isCount":true,"rowspan":1,"colspan":1},{"title":15,"percentage":55.55555555555556,"isCount":true,"rowspan":1,"colspan":1},{"title":27,"percentage":0.0010280161040626436,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Other Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Other Hispanic"},{"title":216,"percentage":54.82233502538071,"isCount":true,"rowspan":1,"colspan":1},{"title":178,"percentage":45.17766497461929,"isCount":true,"rowspan":1,"colspan":1},{"title":394,"percentage":0.015001420185210428,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Non-Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Non-Hispanic"},{"title":29385,"percentage":48.63133854097709,"isCount":true,"rowspan":1,"colspan":1},{"title":31039,"percentage":51.3686614590229,"isCount":true,"rowspan":1,"colspan":1},{"title":60424,"percentage":2.3006238915511545,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Unknown","isCount":false,"rowspan":1,"colspan":1,"key":"Unknown"},{"title":111,"percentage":41.11111111111111,"isCount":true,"rowspan":1,"colspan":1},{"title":159,"percentage":58.88888888888889,"isCount":true,"rowspan":1,"colspan":1},{"title":270,"percentage":0.010280161040626434,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Total","isCount":false,"rowspan":1,"colspan":3,"isBold":true},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"ageAdjustedRate":"435.2","standardPop":264386329}],[{"title":"Black","isCount":false,"rowspan":13,"colspan":1,"key":"Black"},{"title":"Central and South American","isCount":false,"rowspan":1,"colspan":1,"key":"Central and South American"},{"title":49,"percentage":44.14414414414414,"isCount":true,"rowspan":1,"colspan":1},{"title":62,"percentage":55.85585585585585,"isCount":true,"rowspan":1,"colspan":1},{"title":111,"percentage":0.0042262884278130896,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Central American","isCount":false,"rowspan":1,"colspan":1,"key":"Central American"},{"title":256,"percentage":52.138492871690424,"isCount":true,"rowspan":1,"colspan":1},{"title":235,"percentage":47.86150712830957,"isCount":true,"rowspan":1,"colspan":1},{"title":491,"percentage":0.018694663225731777,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Cuban","isCount":false,"rowspan":1,"colspan":1,"key":"Cuban"},{"title":160,"percentage":46.647230320699705,"isCount":true,"rowspan":1,"colspan":1},{"title":183,"percentage":53.352769679300295,"isCount":true,"rowspan":1,"colspan":1},{"title":343,"percentage":0.013059611988647656,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Dominican","isCount":false,"rowspan":1,"colspan":1,"key":"Dominican"},{"title":425,"percentage":50.898203592814376,"isCount":true,"rowspan":1,"colspan":1},{"title":410,"percentage":49.101796407185624,"isCount":true,"rowspan":1,"colspan":1},{"title":835,"percentage":0.03179234988490027,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Latin American","isCount":false,"rowspan":1,"colspan":1,"key":"Latin American"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":12,"isCount":true,"rowspan":1,"colspan":1},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Mexican","isCount":false,"rowspan":1,"colspan":1,"key":"Mexican"},{"title":233,"percentage":43.30855018587361,"isCount":true,"rowspan":1,"colspan":1},{"title":305,"percentage":56.69144981412639,"isCount":true,"rowspan":1,"colspan":1},{"title":538,"percentage":0.020484172740211193,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Puerto Rican","isCount":false,"rowspan":1,"colspan":1,"key":"Puerto Rican"},{"title":222,"percentage":38.608695652173914,"isCount":true,"rowspan":1,"colspan":1},{"title":353,"percentage":61.39130434782609,"isCount":true,"rowspan":1,"colspan":1},{"title":575,"percentage":0.021892935549482222,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"South American","isCount":false,"rowspan":1,"colspan":1,"key":"South American"},{"title":42,"percentage":45.65217391304348,"isCount":true,"rowspan":1,"colspan":1},{"title":50,"percentage":54.347826086956516,"isCount":true,"rowspan":1,"colspan":1},{"title":92,"percentage":0.0035028696879171556,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Spaniard","isCount":false,"rowspan":1,"colspan":1,"key":"Spaniard"},{"title":"suppressed","isCount":true,"rowspan":1,"colspan":1},{"title":0,"percentage":0,"isCount":true},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Other Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Other Hispanic"},{"title":141,"percentage":44.339622641509436,"isCount":true,"rowspan":1,"colspan":1},{"title":177,"percentage":55.660377358490564,"isCount":true,"rowspan":1,"colspan":1},{"title":318,"percentage":0.012107745225626689,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Non-Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Non-Hispanic"},{"title":149008,"percentage":49.0409552270244,"isCount":true,"rowspan":1,"colspan":1},{"title":154836,"percentage":50.9590447729756,"isCount":true,"rowspan":1,"colspan":1},{"title":303844,"percentage":11.568760189733698,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Unknown","isCount":false,"rowspan":1,"colspan":1,"key":"Unknown"},{"title":682,"percentage":38.058035714285715,"isCount":true,"rowspan":1,"colspan":1},{"title":1110,"percentage":61.94196428571429,"isCount":true,"rowspan":1,"colspan":1},{"title":1792,"percentage":0.06822980957334286,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Total","isCount":false,"rowspan":1,"colspan":3,"isBold":true},{"title":"suppressed","percentage":null,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"ageAdjustedRate":"967.6","standardPop":687800625}],[{"title":"White","isCount":false,"rowspan":13,"colspan":1,"key":"White"},{"title":"Central and South American","isCount":false,"rowspan":1,"colspan":1,"key":"Central and South American"},{"title":1122,"percentage":48.21658788139235,"isCount":true,"rowspan":1,"colspan":1},{"title":1205,"percentage":51.78341211860765,"isCount":true,"rowspan":1,"colspan":1},{"title":2327,"percentage":0.08859975830199153,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Central American","isCount":false,"rowspan":1,"colspan":1,"key":"Central American"},{"title":3367,"percentage":48.85374347069066,"isCount":true,"rowspan":1,"colspan":1},{"title":3525,"percentage":51.14625652930934,"isCount":true,"rowspan":1,"colspan":1},{"title":6892,"percentage":0.26241062922961994,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Cuban","isCount":false,"rowspan":1,"colspan":1,"key":"Cuban"},{"title":7285,"percentage":48.96162376503797,"isCount":true,"rowspan":1,"colspan":1},{"title":7594,"percentage":51.03837623496202,"isCount":true,"rowspan":1,"colspan":1},{"title":14879,"percentage":0.5665130226795583,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Dominican","isCount":false,"rowspan":1,"colspan":1,"key":"Dominican"},{"title":1547,"percentage":51.42952127659575,"isCount":true,"rowspan":1,"colspan":1},{"title":1461,"percentage":48.57047872340425,"isCount":true,"rowspan":1,"colspan":1},{"title":3008,"percentage":0.11452860892668265,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Latin American","isCount":false,"rowspan":1,"colspan":1,"key":"Latin American"},{"title":346,"percentage":48.4593837535014,"isCount":true,"rowspan":1,"colspan":1},{"title":368,"percentage":51.540616246498594,"isCount":true,"rowspan":1,"colspan":1},{"title":714,"percentage":0.027185314751878794,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Mexican","isCount":false,"rowspan":1,"colspan":1,"key":"Mexican"},{"title":41395,"percentage":43.78477290516384,"isCount":true,"rowspan":1,"colspan":1},{"title":53147,"percentage":56.21522709483616,"isCount":true,"rowspan":1,"colspan":1},{"title":94542,"percentage":3.599655500381128,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Puerto Rican","isCount":false,"rowspan":1,"colspan":1,"key":"Puerto Rican"},{"title":9581,"percentage":45.7895239915886,"isCount":true,"rowspan":1,"colspan":1},{"title":11343,"percentage":54.21047600841139,"isCount":true,"rowspan":1,"colspan":1},{"title":20924,"percentage":0.796674405978028,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"South American","isCount":false,"rowspan":1,"colspan":1,"key":"South American"},{"title":2962,"percentage":50.32279986408427,"isCount":true,"rowspan":1,"colspan":1},{"title":2924,"percentage":49.67720013591573,"isCount":true,"rowspan":1,"colspan":1},{"title":5886,"percentage":0.2241075106856563,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Spaniard","isCount":false,"rowspan":1,"colspan":1,"key":"Spaniard"},{"title":276,"percentage":46.231155778894475,"isCount":true,"rowspan":1,"colspan":1},{"title":321,"percentage":53.768844221105525,"isCount":true,"rowspan":1,"colspan":1},{"title":597,"percentage":0.022730578300940673,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Other Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Other Hispanic"},{"title":6750,"percentage":46.21704895583704,"isCount":true,"rowspan":1,"colspan":1},{"title":7855,"percentage":53.782951044162964,"isCount":true,"rowspan":1,"colspan":1},{"title":14605,"percentage":0.5560805629568485,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Non-Hispanic","isCount":false,"rowspan":1,"colspan":1,"key":"Non-Hispanic"},{"title":1031604,"percentage":49.909504298364396,"isCount":true,"rowspan":1,"colspan":1},{"title":1035345,"percentage":50.0904957016356,"isCount":true,"rowspan":1,"colspan":1},{"title":2066949,"percentage":78.69840215837692,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Unknown","isCount":false,"rowspan":1,"colspan":1,"key":"Unknown"},{"title":2652,"percentage":40.44532560622236,"isCount":true,"rowspan":1,"colspan":1},{"title":3905,"percentage":59.55467439377764,"isCount":true,"rowspan":1,"colspan":1},{"title":6557,"percentage":0.24965561460513902,"isCount":true,"rowspan":1,"colspan":1,"isBold":true}],[{"title":"Total","isCount":false,"rowspan":1,"colspan":3,"isBold":true},{"title":2237880,"percentage":85.2065436651744,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"ageAdjustedRate":"777.0","standardPop":4095812508}]],"calculatePercentage":true};

        // var table = {"headers":[[{"colspan":1,"rowspan":1,"title":"Race"},{"title":"Female","colspan":1,"rowspan":1,"isData":true},{"title":"Male","colspan":1,"rowspan":1,"isData":true},{"title":"Number of Deaths","colspan":1,"rowspan":1,"isData":true}]],"data":[[{"title":"American Indian","isCount":false,"rowspan":1,"colspan":1,"key":"American Indian"},{"title":8179,"percentage":45.41870279875611,"isCount":true,"rowspan":1,"colspan":1,"pop":28544528,"ageAdjustedRate":"557.9","standardPop":32250198},{"title":9829,"percentage":54.58129720124389,"isCount":true,"rowspan":1,"colspan":1,"pop":28645741,"ageAdjustedRate":"754.4","standardPop":32369216},{"title":18008,"percentage":0.6856486667392624,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":57190269,"ageAdjustedRate":"647.7","standardPop":64619414}],[{"title":"Asian or Pacific Islander","isCount":false,"rowspan":1,"colspan":1,"key":"Asian or Pacific Islander"},{"title":29884,"percentage":48.536624979697905,"isCount":true,"rowspan":1,"colspan":1,"pop":121309960,"ageAdjustedRate":"368.3","standardPop":137270512},{"title":31686,"percentage":51.463375020302095,"isCount":true,"rowspan":1,"colspan":1,"pop":112325576,"ageAdjustedRate":"524.1","standardPop":127115817},{"title":61570,"percentage":2.3442574639680354,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":233635536,"ageAdjustedRate":"435.2","standardPop":264386329}],[{"title":"Black","isCount":false,"rowspan":1,"colspan":1,"key":"Black"},{"title":151227,"percentage":48.94711289487312,"isCount":true,"rowspan":1,"colspan":1,"pop":317237591,"ageAdjustedRate":"807.4","standardPop":359386608},{"title":157733,"percentage":51.05288710512688,"isCount":true,"rowspan":1,"colspan":1,"pop":289840863,"ageAdjustedRate":"1,193.3","standardPop":328414017},{"title":308960,"percentage":11.763550204118308,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":607078454,"ageAdjustedRate":"967.6","standardPop":687800625}],[{"title":"White","isCount":false,"rowspan":1,"colspan":1,"key":"White"},{"title":1108887,"percentage":49.55078020269183,"isCount":true,"rowspan":1,"colspan":1,"pop":1828192603,"ageAdjustedRate":"660.1","standardPop":2070887962},{"title":1128993,"percentage":50.44921979730817,"isCount":true,"rowspan":1,"colspan":1,"pop":1787480522,"ageAdjustedRate":"922.5","standardPop":2024924546},{"title":2237880,"percentage":85.2065436651744,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":3615673125,"ageAdjustedRate":"777.0","standardPop":4095812508}]],"calculatePercentage":true};
        ctrl.compileTable(table);

        expect(window.Clusterize).toHaveBeenCalled();
    });

    it('compileTable should be triggered onChange', function() {
        var bindings = {tableView: 'crude_death_rates'};
        var ctrl = $componentController('owhTable', { $scope: $scope }, bindings);

        spyOn(ctrl, "compileTable");
        var table = {"headers":[[{"colspan":1,"rowspan":1,"title":"Race"},{"title":"Female","colspan":1,"rowspan":1,"isData":true},{"title":"Male","colspan":1,"rowspan":1,"isData":true},{"title":"Number of Deaths","colspan":1,"rowspan":1,"isData":true}]],"data":[[{"title":"American Indian","isCount":false,"rowspan":1,"colspan":1,"key":"American Indian"},{"title":8179,"percentage":45.41870279875611,"isCount":true,"rowspan":1,"colspan":1,"pop":28544528,"ageAdjustedRate":"557.9","standardPop":32250198},{"title":9829,"percentage":54.58129720124389,"isCount":true,"rowspan":1,"colspan":1,"pop":28645741,"ageAdjustedRate":"754.4","standardPop":32369216},{"title":18008,"percentage":0.6856486667392624,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":57190269,"ageAdjustedRate":"647.7","standardPop":64619414}],[{"title":"Asian or Pacific Islander","isCount":false,"rowspan":1,"colspan":1,"key":"Asian or Pacific Islander"},{"title":29884,"percentage":48.536624979697905,"isCount":true,"rowspan":1,"colspan":1,"pop":121309960,"ageAdjustedRate":"368.3","standardPop":137270512},{"title":31686,"percentage":51.463375020302095,"isCount":true,"rowspan":1,"colspan":1,"pop":112325576,"ageAdjustedRate":"524.1","standardPop":127115817},{"title":61570,"percentage":2.3442574639680354,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":233635536,"ageAdjustedRate":"435.2","standardPop":264386329}],[{"title":"Black","isCount":false,"rowspan":1,"colspan":1,"key":"Black"},{"title":151227,"percentage":48.94711289487312,"isCount":true,"rowspan":1,"colspan":1,"pop":317237591,"ageAdjustedRate":"807.4","standardPop":359386608},{"title":157733,"percentage":51.05288710512688,"isCount":true,"rowspan":1,"colspan":1,"pop":289840863,"ageAdjustedRate":"1,193.3","standardPop":328414017},{"title":308960,"percentage":11.763550204118308,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":607078454,"ageAdjustedRate":"967.6","standardPop":687800625}],[{"title":"White","isCount":false,"rowspan":1,"colspan":1,"key":"White"},{"title":1108887,"percentage":49.55078020269183,"isCount":true,"rowspan":1,"colspan":1,"pop":1828192603,"ageAdjustedRate":"660.1","standardPop":2070887962},{"title":1128993,"percentage":50.44921979730817,"isCount":true,"rowspan":1,"colspan":1,"pop":1787480522,"ageAdjustedRate":"922.5","standardPop":2024924546},{"title":2237880,"percentage":85.2065436651744,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":3615673125,"ageAdjustedRate":"777.0","standardPop":4095812508}]],"calculatePercentage":true};

        ctrl.$onChanges();

        expect(ctrl.compileTable).toHaveBeenCalled();
    });

    it('should compileTable for bridge race tableView', function() {
        var bindings = {tableView: 'bridge_race'};
        var ctrl = $componentController('owhTable', { $scope: $scope }, bindings);

        spyOn(window, "Clusterize");
        var table = {"headers":[[{"colspan":1,"rowspan":1,"title":"Race"},{"title":"Female","colspan":1,"rowspan":1,"isData":true},{"title":"Male","colspan":1,"rowspan":1,"isData":true},{"title":"Number of Deaths","colspan":1,"rowspan":1,"isData":true}]],"data":[[{"title":"American Indian","isCount":false,"rowspan":1,"colspan":1,"key":"American Indian"},{"title":8179,"percentage":45.41870279875611,"isCount":true,"rowspan":1,"colspan":1,"pop":28544528,"ageAdjustedRate":"557.9","standardPop":32250198},{"title":9829,"percentage":54.58129720124389,"isCount":true,"rowspan":1,"colspan":1,"pop":28645741,"ageAdjustedRate":"754.4","standardPop":32369216},{"title":18008,"percentage":0.6856486667392624,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":57190269,"ageAdjustedRate":"647.7","standardPop":64619414}],[{"title":"Asian or Pacific Islander","isCount":false,"rowspan":1,"colspan":1,"key":"Asian or Pacific Islander"},{"title":29884,"percentage":48.536624979697905,"isCount":true,"rowspan":1,"colspan":1,"pop":121309960,"ageAdjustedRate":"368.3","standardPop":137270512},{"title":31686,"percentage":51.463375020302095,"isCount":true,"rowspan":1,"colspan":1,"pop":112325576,"ageAdjustedRate":"524.1","standardPop":127115817},{"title":61570,"percentage":2.3442574639680354,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":233635536,"ageAdjustedRate":"435.2","standardPop":264386329}],[{"title":"Black","isCount":false,"rowspan":1,"colspan":1,"key":"Black"},{"title":151227,"percentage":48.94711289487312,"isCount":true,"rowspan":1,"colspan":1,"pop":317237591,"ageAdjustedRate":"807.4","standardPop":359386608},{"title":157733,"percentage":51.05288710512688,"isCount":true,"rowspan":1,"colspan":1,"pop":289840863,"ageAdjustedRate":"1,193.3","standardPop":328414017},{"title":308960,"percentage":11.763550204118308,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":607078454,"ageAdjustedRate":"967.6","standardPop":687800625}],[{"title":"White","isCount":false,"rowspan":1,"colspan":1,"key":"White"},{"title":1108887,"percentage":49.55078020269183,"isCount":true,"rowspan":1,"colspan":1,"pop":1828192603,"ageAdjustedRate":"660.1","standardPop":2070887962},{"title":1128993,"percentage":50.44921979730817,"isCount":true,"rowspan":1,"colspan":1,"pop":1787480522,"ageAdjustedRate":"922.5","standardPop":2024924546},{"title":2237880,"percentage":85.2065436651744,"isCount":true,"rowspan":1,"colspan":1,"isBold":true,"pop":3615673125,"ageAdjustedRate":"777.0","standardPop":4095812508}]],"calculatePercentage":true};
        ctrl.compileTable(table);

        expect(window.Clusterize).toHaveBeenCalled();
    });
});

